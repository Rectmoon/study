<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>

    <style>
      #box {
        width: 100px;
        height: 100px;
        background-color: orange;
      }
    </style>
    <script src="js/lib/moon.js"></script>
    <script src="js/lib/dialog.js"></script>
  </head>
  <body>
    <div id="box"></div>
    <script>
      class FlowHelper {
        constructor() {
          this.pid = 0
          this.steps = []
        }
        init() {
          this.pid = 0
          this.doStep()
        }
        next(data) {
          if (typeof this.steps[this.pid + 1] === 'function') {
            this.pid++
            this.doStep(data)
          }
        }
        doStep(data) {
          if (typeof this.steps[this.pid] === 'function') {
            this.steps[this.pid].call(this, data)
          }
        }
        register(...args) {
          args.forEach(arg => {
            if (typeof arg === 'function') {
              this.steps.push(arg)
            }
          })
        }
      }

      function isNetWorkConnected() {
        this.next()
      }

      function bindEvents() {
        moon.addHandler(m('box'), 'click', function() {
          console.log(2)
        })
      }

      function pageInit() {
        var f = new FlowHelper()
        f.register(isNetWorkConnected, bindEvents)
        f.init()
      }

      moon.ready(function() {
        pageInit()
      })
    </script>
  </body>
</html>
